// ---------------------------------------------------------------------------
// Settings

$post-byline-cols : 2;
$post-size        : $smallpx;
$post-time-size   : $xsmallpx;
$post-v-padding   : .25;
$post-h-padding   : gutter($center);

$background       : $base2;

// ---------------------------------------------------------------------------
// Village Feed

.village-feed {
  @extend %overflow-y;
  @include stretch;
  bottom: rhythm(4.75);
  height: auto;
}

$instruction-height: rhythm(5.5);

.feed-posts {
  @include inset;
  min-height: 100%;
  background: $base2;
  .stickyhack {
    clear: both;
    display: block;
    height: $instruction-height;
  }
}

// ---------------------------------------------------------------------------
// Getting Started

.getting-started {
  @include padding-leader;
  @include trailing-border(1px,1);
  @include box-shadow($inset-color 0 $inset-size $inset-size);
  padding-left: $post-h-padding;
  padding-right: $post-h-padding;
  border: 0;
  background: $base3;
  .starthead {
    @include serif;
    @include adjust-font-size-to($medpx);
    color: $base1;
  }
  + .post { border-top: 1px solid; }
}

.instructions {
  @include box-shadow($base 0 0 3px inset);
  @include background($base2);
  @include background($base2
    linear-gradient(
      -45deg,
      rgba($base1,.075) 25%,
      rgba($base1,0) 25%,
      rgba($base1,0) 50%,
      rgba($base1,.075) 50%,
      rgba($base1,.075) 75%,
      rgba($base1,0) 75%
    ) repeat scroll
  );
  @include background-size(4em 4em);
  margin-top: - $instruction-height;
  padding: rhythm(1) $post-h-padding;
}
.howto {
  @include pie-clearfix;
  clear: both;
  counter-reset: howto;
}

[class^="howto-"] {
  @include rhythm-borders(1px,.75);
  @include border-radius(.25em);
  @include arrow(bottom $base-size/2 $base3, 1.5px $orange);
  @include box-shadow($back 0 0 .25em);
  position: relative;
  float: right;
  width: columns(6,$center);
  background: $base3;
  color: $orange;
  font-style: italic;
  counter-increment: howto;
  &:first-child { float: left; }
  p:before {
    @include border-radius(8em);
    content: counter(howto,decimal);
    position: absolute;
    top: rhythm(-.75);
    left: rhythm(-.5);
    padding: rhythm(.125) rhythm(.375);
    background: $orange;
    color: $base3;
    font-style: normal;
  }
}

// ---------------------------------------------------------------------------
// Posts

.feed-posts { @include inset; }

.post {
  @include pie-clearfix;
  @include adjust-font-size-to($post-size);
  @include trailing-border(1px, $post-v-padding, $post-size);
  padding-left: $post-h-padding;
  padding-right: $post-h-padding;
  border-color: $base1;
  background: $base3;

  &.old {
    color: $base1;
    background: color($base3 lighter);
    .title, .summary { color: $base1; }
  }
  &.mine { background: lighten($blue,45); }
  &.not-posted { background: lighten($red,45); }

  .timeout {
    @extend %error;
    @include bleed($post-h-padding);
  }

  &:last-of-type { @include box-shadow($inset-color 0 $inset-size $inset-size); }
}

.post-meta {
  @include pie-clearfix;
  position: relative;
  color: $base1;

  .byline, .pubdate {
    @include ellipsis;
    max-width: 45%;
  }
  .byline { float: left; }
  .title {
    color: $base;
    font-weight: bold;
  }
  .pubdate {
    @include adjust-font-size-to($post-time-size, 1, $post-size);
    @include cond;
    float: right;
    text-align: right;
    &:first-letter { text-transform: uppercase; }
  }
}

.sms-info {
  .summary {
    @extend %icon-replace;
    float: left;
    margin-right: .2em;
    .sms & { @extend %icon-bubble-check; }
    .no-sms & { @extend %icon-bubble-notification; }
  }

  .details-body {
    @include bleed($post-h-padding);
    @include trailer($post-v-padding);
    @include arrow(bottom $post-h-padding .375em $base1);
    display: none;
    background: $base1;
    color: $base3;
    &:after { left: $post-h-padding; margin-left: 0; }
  }
}

.post-text { @include clearfix; }

.nametag {
  @include border-radius(4px);
  display: inline-block;
  padding: 0 .4em;
  border: 1px solid $base01;
  background: rgba($base1,.25);
  &.me {
    background: $blue;
    color: $base3;
  }
}

// ---------------------------------------------------------------------------
// Post Add Form

$addnote-fontsize: $input-font-size;
$postaction-size: $smallpx;

%post-targeting {
  @include adjust-font-size-to($postaction-size);
  @include trailer(.5);
  text-align: left;
}

.post-add-form {
  @extend %formdefaults;
  @include stretch-x;
  @include box-shadow($inset-color 0 0 $inset-size);
  bottom: 0;
  padding: rhythm(.5) gutter();
  border-top: 1px solid $base;
  background: $base2;
  text-align: right;
  &.group-posts { background: mix($blue,$base2,25%); }

  .form-actions {
    clear: none;
    margin: 0;
    .action-post.action-post {
      @include border-left-radius(0);
      float: right;
      width: space(2, $center);
      height: rhythm(2.5);
    }
  }

  .sms-targeting {
    @extend %post-targeting;
    > .type {
      display: inline;
      font-weight: bold;
      cursor: default;
    }
    .multiselect-dropdown { min-width: columns(2, $center); }
    .ui-multiselect { width: 100%; }
  }
  .group-targeting {
    @extend %post-targeting;
    @extend %icon;
    @extend %icon-warning;
    font-weight: bold;
  }
}

.post-textfield {
  @include span-columns($center - 2, $center);
  margin: 0;
  .value {
    @include trailer(.125);
    height: rhythm(2.5);
    margin: 0;
    background: rgba(white,.75);
    padding-left: rhythm(.5);
    resize: none;
  }
  .charcount {
    @include adjust-font-size-to($xsmallpx);
    position: absolute;
    right: .25em;
    bottom: 0;
    color: $base1;
    &.overlimit { color: $red; }
  }
}

// ---------------------------------------------------------------------------
// Errors

.feed-error {
  @extend %error;
  padding: rhythm(1);
}
