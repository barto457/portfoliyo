// ---------------------------------------------------------------------------
// Form Resets

input[type="button"], input[type="submit"], input[type="image"],
label, button { cursor: pointer; }

input {
  &[type="search"] { -webkit-appearance: none; }
  &[type="radio"], &[type="checkbox"] { vertical-align: baseline; width: auto !important; }
  &::-webkit-search-decoration { display: none; }
}

textarea {
  overflow: auto;
  resize: vertical;
}

button, input[type="select"], select, textarea {
  @include border-radius(0);
}

optgroup { @include reset-box-model; }

optgroup {
  color: $base;
  font-style: normal;
  font-weight: normal;
}

legend { .iem7 & { margin-left: -7px; } }

::-moz-focus-inner { border: 0; }

// ---------------------------------------------------------------------------
// Placeholders

@mixin placeholder {
  ::-webkit-input-placeholder { @content; }
  :-moz-placeholder { @content; }
  .placeholder { @content; }
}

@include placeholder {
  font-style: italic;
}

// ---------------------------------------------------------------------------
// Form Helpers

$input-font-size: $smallpx;
$input-rhythm: .25;

%input {
  @include sans;
  @include adjust-font-size-to($input-font-size);
  @include rhythm-borders(1px,$input-rhythm,$input-font-size);
  @include rgba-background(rgba(white,.25));
  width: 100%;
  color: inherit;
  border-color: inherit;
  vertical-align: top;
  outline: 0;
}

@mixin button-color($color: $green) {
  $light  : adjust-color($color, $lightness: 5%);
  $dark   : adjust-color($color, $lightness: -15%);
  @include background(linear-gradient(top, rgba($light,.25), rgba($color,0), rgba($dark,.25)));
  background-color: $color;
  border-color: mix($color,$back);
  &:hover, &:focus { background-color: $light; }
  &:active { background-color: $color; }
}

@mixin small-button($fontsize: false) {
  $size: $smallpx;
  @if $fontsize {
    @include adjust-font-size-to($fontsize);
    $size: $fontsize;
  }
  @include h-borders(1px,.125);
}

@mixin button($color: $green) {
  @include border-radius(.25em);
  @include rhythm-borders(1px,.25);
  @include button-color($green);
  @include box-shadow(rgba(white,.5) 0 1px 1px inset);
  @include text-shadow(rgba($back,.5) 0 -1px 0);
  display: inline-block;
  margin: 0;
  padding-left: 1em;
  padding-right: 1em;
  color: $base3;
  text-align: center;
  #{$link}, #{$focus} { color: $base3; }
  &:active { @include box-shadow(rgba($back,.5) 0 0 .25em inset); }
}

%button { @include button; }

@mixin reset-button {
  @include reset-box-model;
  @include reset-font;
  background: none;
  color: inherit;
  text-align: left;
}

%reset-button {
  @include reset-button;
  @include box-shadow(none);
  @include text-shadow(none);
}

.linkaction { @extend %button; }

.errorlist {
  @include no-style-list;
  color: $red;
}

.formfield {
  @include pie-clearfix;
  @include trailer(.5);
  position: relative;
}

@mixin inline-form($label: $left, $input: $center - $label, $context: $center, $radio-check: false) {
  .type {
    @include ellipsis;
    @include span-columns($label,$context);
    @include rem(padding, rhythm($input-rhythm) 0);
    text-align: right;
    + .value { @include span-columns($input omega,$context); }
  }
  @if $radio-check { @include inline-radio-checkbox($label, $input, $context); }
  .formfield-help { @include pre($label, $context); }
}

@mixin inline-radio-checkbox($label: $left, $input: $center - $label, $context: $center) {
  [type="checkbox"], [type="radio"] {
    + .type {
      display: inline-block;
      width: auto;
      margin: 0;
      padding: 0;
      text-align: left;
    }
  }
}

.iqtest {
  @include trailer(2);
  > p {
    @include leader;
    @include leading-border(2px,1);
    font-style: italic;
  }
}

$arrow-width: 1rem;
$step-back: mix($base,$base2,12.5%);
$active-back: mix($base,$base2,25%);

.form-steps {
  @include adjust-font-size-to($smallpx);
  @include inline-block-list;
  @include trailer;
  padding: 0 !important;
  background: $base2;
  counter-reset: form-steps;
  li {
    position: relative;
    padding: rhythm(.25) rhythm(.25) rhythm(.25) $arrow-width*1.5;
    margin-left: -.2em;
    background: $step-back;
    counter-increment: form-steps;
    &:first-child { padding-left: rhythm(.5); }
    &:before {
      content: counter(form-steps,decimal) ". ";
      font-weight: bold;
    }
    &:after {
      @include stretch-y;
      left: 100%;
      content: " ";
      width: $arrow-width;
      border: $arrow-width*.5 solid rgba($base,0);
      border-width: rhythm(.75) 0 rhythm(.75) $arrow-width;
      border-left-color: $step-back;
      z-index: 10;
    }
  }
  .active {
    color: $orange;
    background: $active-back;
    &:after { border-left-color: $active-back; }
  }
}

// ---------------------------------------------------------------------------
// Elements

%radio-check-defaults {
  [type="checkbox"], [type="radio"] {
    @include gone;
    + .type {
      @extend %icon;
      display: block;
      font-style: italic;
      &:before {
        @include adjust-font-size-to($smallpx);
        margin-left: .4em;
        color: $base01;
      }
    }
    &[aria-checked="true"] + .type {
      &:before { color: $blue; }
    }
    &:focus + .type { color: $base03; }
  }

  [type="checkbox"] {
    + .type { @extend %icon-unchecked; }
    &[aria-checked="true"] + .type { @extend %icon-checked; }
  }

  [type="radio"] {
    + .type { @extend %icon-radio-unchecked; }
    &[aria-checked="true"] + .type { @extend %icon-radio-checked; }
  }
}

%formdefaults {
  .type {
    display: block;
    color: $base01;
  }

  input {
    &[type="text"], &[type="password"],
    &[type="email"], &[type="url"], &[type="tel"],
    &[type="date"], &[type="datetime"], &[type="datetime-local"],
    &[type="month"], &[type="week"], &[type="time"],
    &[type="number"], &[type="search"], &[type="color"] {
      @extend %input;
      @include rem(min-height, rhythm(1 + $input-rhythm*2, $input-font-size));
      margin: 0;
    }
  }

  textarea {
    @extend %input;
    @include transition(200ms min-height);
    @include rem(min-height, rhythm(1 + $input-rhythm*2, $input-font-size));
  }

  fieldset {
    @include box-shadow($back 0 0 .25em inset);
    @include leader;
    @include trailer;
    padding: rhythm(1);
    background: $base2;
  }

  .fieldset-header {
    @include trailer;
  }

  .fieldset-help {
    @include leader;
    @include trailer(.5);
    font-style: italic;
  }

  .formfield-help {
    @include adjust-font-size-to($smallpx);
    display: block;
    clear: both;
    margin: 0;
    color: $base1;
    font-style: italic;
    text-align: right;
  }

  .formfield-optional, .fieldset-optional {
    @include adjust-font-size-to($smallpx);
    color: $base1;
  }
  .optional-fieldset { .formfield-optional { @include gone; } }

  $form-action-note-size: $smallpx;

  .form-actions {
    @include rhythm(.5,0,0,.5);
    position: relative;
    clear: both;
    text-align: right;
    p {
      @include adjust-font-size-to($form-action-note-size);
      @include rem(margin, 0 .4em rhythm(.5,$form-action-note-size) 0);
      display: inline-block;
    }
    button {
      @extend %button;
      text-transform: capitalize;
    }
  }
}

button { @include reset-button; }

// ---------------------------------------------------------------------------
// Radio/Checkbox Options

.options-header {
  @include clearfix;
  @include rem(padding, rhythm(.25));
  background: $base;
  color: $base3;
  font-weight: bold;
  ul { @include no-style-list; }
  li {
    @include span-columns(4,$center);
    @include adjust-font-size-to($smallpx);
  }
}

%check-option {
  @include clearfix;
  position: relative;
}

%check-value {
  @include gone;
  &[aria-checked="true"] + .type { @extend %options-checked; }
  &.disabled + .type { @extend %options-disabled; }
}

%check-type {
  display: block;
  position: relative;
  padding-right: 1em;
  text-align: left;
  #{$focus} { background: $base3; }
  &:before { float: left; }
}

%check-options-base {
  @include reset-box-model;
  @include no-style-list;
  overflow-y: scroll;
}

%check-options {
  @extend %check-options-base;
  @include adjust-font-size-to($input-font-size);
  @include rgba-background(rgba(white,.25));
  @include rem(max-height, rhythm(8,$input-font-size));
  border: 1px solid;
  .option {
    @extend %check-option;
    .type {
      float: none;
      width: auto;
      margin: 0;
    }
  }
  .value { @extend %check-value; }
  .type {
    @extend %check-type;
    @include padding-leader(.125,$input-font-size);
    @include trailing-border(1px,.125,$input-font-size);
    @include rem(padding-left, rhythm(.125,$input-font-size));
    border-color: $base1;
    border-color: rgba($base1,.25);
  }
}

%options-checked {
  @include rgba-background(rgba($blue,.125));
  font-weight: bold;
}

%options-disabled {
  @extend %icon;
  @extend %icon-locked;
}

// ---------------------------------------------------------------------------
// ui multiselect

.multiselect-dropdown {
  position: relative;
  display: inline-block;
}

.ui-multiselect {
  @extend %icon;
  @extend %icon-arrow-down;
  @include border-radius(3px);
  @include rgba-background(rgba(white,.5));
  position: relative;
  padding: 0 1.4em 0 .4em;
  min-width: columns-width(4);
  border: 1px solid $base1;
  color: inherit;
  &:before {
    position: absolute;
    right: 0;
    margin: 0;
  }
  #{$focus} {
    @include rgba-background(rgba(white,.75));
  }
}

.ui-multiselect-menu {
  @include rhythm-borders(1px,.25);
  @include box-shadow;
  @include css-arrow(bottom, .5em, $base);
  position: absolute;
  right: 0;
  bottom: 100%;
  min-width: 100%;
  background: $base3;
  z-index: 900;
}

.ui-multiselect-checkboxes {
  @extend %radio-check-defaults;
  @include cond;
  @include padding-leader(.5);
  @include padding-trailer(.5);
  border-color: $base1;

  li { @extend %check-option; }
  input { @extend %check-value; }
  label {
    @extend %ellipsis;
    @extend %check-type;
  }
  b { font-weight: bold; }
}

.ui-multiselect-header {
  @include clearfix;
  position: relative;
  text-align: left;
  li {
    @include span-columns(2,4);
    &.ui-multiselect-close { display: none; }
    + li { @include omega; }
  }
}

.ui-multiselect-all, .ui-multiselect-none {
  @extend %icon;
  @extend %icon-checkmark;
  @extend %button;
  width: 100%;
  padding: 0 .5em;
  font-weight: bold;
  text-align: center;
}
.ui-multiselect-none {
  @extend %icon-x;
  @include button-color($red);
}
