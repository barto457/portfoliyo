{% load elders %}
{% load url from future %}

<div class="village-elders">

  {% with nav_elders|elder_types as elder_types %}
  {% for elder_type in elder_types %}

  <h2 class="elders-title">{% if elder_type.school_staff %}Teachers{% else %}Family Members{% endif %}</h2>

  {% if elder_type.elders %}
  <ul>
    {% for nav_elder in elder_type.elders %}
    {% if not nav_elder.school_staff %}

    {# Parents ----------------------------------------- #}
    <li class="elder parent">
      {% if nav_elder|elder_status:request.user.profile == 'mobile' %}
      <a href="#" class="action-sms" title="text {% firstof nav_elder.name nav_elder.user.email nav_elder.phone %}" data-name="{% firstof nav_elder.name nav_elder.user.email nav_elder.phone %}">send sms</a>
      {% else %}
      <span class="no-sms">{{ nav_elder|elder_status_description:request.user.profile }}</span>
      {% endif %}

      {% if request.user.profile.school_staff %}
      <a href="{% block edit-elder-url %}{% endblock %}" class="vcard listitem-select action-edit ajax-link {{ nav_elder|elder_status:request.user.profile }}{% if nav_elder == elder %} active{% endif %}" title="edit {% firstof nav_elder.name nav_elder.user.email nav_elder.phone %}">
        {% include "village/elders_list/_elder_info.html" %}
      </a>
      {% else %}
      <span class="vcard {{ nav_elder|elder_status:request.user.profile }}{% if nav_elder == elder %} active{% endif %}">
        {% include "village/elders_list/_elder_info.html" %}
      </span>
      {% endif %}
    </li>
    {% else %}

    {# Teachers ----------------------------------------- #}
    <li class="elder teacher" title="{{ nav_elder|elder_status_description:request.user.profile }}">
      <span class="vcard {{ nav_elder|elder_status:request.user.profile }}{% if nav_elder == elder %} active{% endif %}">
        {% include "village/elders_list/_elder_info.html" %}
      </span>
    </li>
    {% endif %}
    {% endfor %}
  </ul>
  {% endif %}

  {% block invite-elder %}
  {% if request.user.profile.school_staff %}
  <a href="{% block invite-elder-url %}{% endblock %}" class="additem-elder ajax-link{% if invite_teacher_active and elder_type.school_staff %} active{% endif %}{% if invite_family_active and not elder_type.school_staff %} active{% endif %}">{% if elder_type.school_staff %}Invite Teacher{% else %}Invite Family Member{% endif %}</a>
  {% endif %}
  {% endblock invite-elder %}

  {% endfor %}
  {% endwith %}
</div>
