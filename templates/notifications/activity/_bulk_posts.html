{% load url from future %}
{% load humanize %}
{% for village_set in bulk_posts.village_sets.values %}

{% if village_set.students|length == 2 %}
<h2>
  In <a href="{{ BASE_URL }}{% url 'village' student_id=village_set.students.0.id %}">{{ village_set.students.0 }}</a> and <a href="{{ BASE_URL }}{% url 'village' student_id=village_set.students.1.id %}">{{ village_set.students.1 }}</a>'s villages:
</h2>
{% endif %}

{% if students|length == 3 %}
<h2>
  In {% for student in students %}{% if forloop.last %}and <a href="{{ village_url }}">{{ student }}</a>{% else %}<a href="{{ village_url }}">{{ student }}</a>, {% endif %}{% endfor %} villages:
</h2>
{% endif %}

{% if students|length > 3 %}
<h2>
  In {% for student in students %}{% if forloop.counter < 4 %}<a href="{{ village_url }}">{{ student }}</a>, {% endif %}{% endfor %}and {{ students|length|add:"-3" }} more village{% if students|length > 4 %}s{% endif %}:
</h2>
{% endif %}

{# posts should NOT include context posts #}
{% for post in village_set.posts %}
  {% include "notifications/activity/includes/_post.html" %}
{% endfor %}

{% endfor %}
